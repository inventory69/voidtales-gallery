---
import ThemeToggle from '../components/ThemeToggle.jsx';
import { siteConfig } from '../config/site.js';
import { navigationLinks } from '../config/navigation.js';

// Import global and component styles
import '../styles/variables.css';
import '../styles/base.css';
import '../styles/layout.css';
import '../styles/components.css';
import '../styles/hero.css';
import '../styles/responsive.css';
import '../styles/accessibility.css';

import Header from '../components/Header.astro';
import PhotoGrid from '../components/PhotoGrid.astro';
import Footer from '../components/Footer.astro';

// Photo frontmatter type definition
type PhotoFrontmatter = {
  date: string;
  [key: string]: any;
};

// Import all photo markdown files eagerly
const modules = import.meta.glob('../content/photos/*.md', { eager: true });

// Extract frontmatter from each module
const photos = Object.values(modules).map((m) =>
  (m as { frontmatter: PhotoFrontmatter })?.frontmatter ?? m
) as PhotoFrontmatter[];

// Sort photos by date and time (newest first)
const sortedPhotos = photos.sort((a, b) => {
  const dateA = new Date(a.date).getTime();
  const dateB = new Date(b.date).getTime();
  return dateB - dateA;
});
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="manifest" href="/manifest.json" />
    <link href="https://fonts.googleapis.com/css2?family=Macondo&family=Macondo+Swash+Caps&display=swap" rel="stylesheet" />
    <title>{siteConfig.name}</title>
    <meta name="description" content={siteConfig.description} />
    <meta name="keywords" content={siteConfig.keywords.join(', ')} />
    <meta name="author" content={siteConfig.author} />
    <meta property="og:title" content={siteConfig.name} />
    <meta property="og:description" content={siteConfig.description} />
    <meta property="og:image" content={siteConfig.ogImage} />
    <meta property="og:url" content={siteConfig.url} />
    <meta name="twitter:card" content="summary_large_image" />
    <!-- Set theme on initial load -->
    <script>
      // Set theme based on localStorage or system preference
      (function() {
        try {
          var saved = localStorage.getItem('theme');
          var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          var isDark = saved === 'dark' || (!saved && prefersDark);
          document.documentElement.classList.toggle('dark', isDark);
          document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
        } catch(e) {}
      })();
    </script>
  </head>
  <body>
    <div id="background"></div>
    <Header />
    {/* Mobile menu dropdown */}
    <div id="mobile-menu" class="mobile-menu">
      <nav class="mobile-nav" role="navigation" aria-label="Mobile navigation">
        {navigationLinks.map(link => (
          <a href={link.href} class="nav-link">{link.label}</a>
        ))}
      </nav>
      <div class="mobile-actions">
        <ThemeToggle client:load />
      </div>
    </div>
    
    {/* Hero section */}
    <section class="hero">
      <div class="hero-content">
        <h1 class="hero-title">{siteConfig.hero.title}</h1>
        <p class="hero-subtitle">{siteConfig.hero.subtitle}</p>
        <a href="#photos" class="hero-cta">{siteConfig.hero.cta}</a>
      </div>
    </section>
    
    {/* Main photo grid */}
    <div class="page-wrapper">
      <main class="container" role="main" id="photos">
        <PhotoGrid photos={sortedPhotos} />
      </main>
      <Footer />
    </div>

    {/* Mobile menu toggle script */}
    <script>
      // Toggle mobile menu open/close
      const toggle = document.getElementById('mobile-menu-toggle');
      const menu = document.getElementById('mobile-menu');
      if (toggle && menu) {
        toggle.addEventListener('click', () => {
          menu.classList.toggle('open');
        });
      }
    </script>
  </body>
</html>