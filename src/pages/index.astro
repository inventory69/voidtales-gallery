---
// filepath: /home/liq/voidtales-gallery/src/pages/index.astro
import { siteConfig } from '../config/site.js';
import '../styles/variables.css';
import '../styles/base.css';
import '../styles/layout.css';
import '../styles/components.css';
import '../styles/hero.css';
import '../styles/responsive.css';
import '../styles/accessibility.css';
import Header from '../components/Header.astro';
import PhotoGrid from '../components/PhotoGrid.astro';
import Footer from '../components/Footer.astro';

type PhotoFrontmatter = {
  date: string;
  [key: string]: any;
};

const modules = import.meta.glob('../content/photos/*.md', { eager: true });
const photos = Object.values(modules).map((m) => (m as { frontmatter: PhotoFrontmatter })?.frontmatter ?? m) as PhotoFrontmatter[];

// Sort by date and time: Newest first (precise to the second)
const sortedPhotos = photos.sort((a, b) => {
  const dateA = new Date(a.date).getTime();  // In milliseconds for precision
  const dateB = new Date(b.date).getTime();
  return dateB - dateA;  // Descending: Newest first
});
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="manifest" href="/manifest.json" />
    <title>{siteConfig.name}</title>
    <meta name="description" content={siteConfig.description} />
    <meta name="keywords" content={siteConfig.keywords.join(', ')} />
    <meta name="author" content={siteConfig.author} />
    <meta property="og:title" content={siteConfig.name} />
    <meta property="og:description" content={siteConfig.description} />
    <meta property="og:image" content={siteConfig.ogImage} />
    <meta property="og:url" content={siteConfig.url} />
    <meta name="twitter:card" content="summary_large_image" />
    <script>
      (function() {
        try {
          var saved = localStorage.getItem('theme');
          var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          var isDark = saved === 'dark' || (!saved && prefersDark);
          document.documentElement.classList.toggle('dark', isDark);
          document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
        } catch(e) {}
      })();
    </script>
  </head>
  <body>
    <Header />
    
    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-content">
        <h1 class="hero-title">{siteConfig.hero.title}</h1>
        <p class="hero-subtitle">{siteConfig.hero.subtitle}</p>
        <a href="#photos" class="hero-cta">{siteConfig.hero.cta}</a>
      </div>
    </section>
    
    <main class="container" role="main" id="photos">
      <PhotoGrid photos={sortedPhotos} />
    </main>

    <Footer />
  </body>
</html>