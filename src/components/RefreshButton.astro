---
const { ariaLabel = "Refresh page", title = "Refresh (force reload)" } = Astro.props;
---
<!-- Refresh button for reloading gallery images without cache -->
<button
  id="refresh-btn"
  class="header-action-btn"
  aria-label={ariaLabel}
  title={title}
  type="button"
>
  <!-- Modern refresh icon (Lucide/Feather style) -->
  <svg id="refresh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
    <path d="M23 4v6h-6" />
    <path d="M1 20v-6h6" />
    <path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10" />
    <path d="M20.49 15a9 9 0 0 1-14.13 3.36L1 14" />
  </svg>
  <script>
    // Attach click handler to refresh button
    const refreshBtn = document.getElementById('refresh-btn');
    const refreshIcon = document.getElementById('refresh-icon');
    if (refreshBtn && refreshIcon) {
      refreshBtn.onclick = async function(e) {
        e.preventDefault();
        // Show loading state
        refreshBtn.classList.add('loading');
        refreshIcon.classList.add('spin');
        try {
          // Dynamically import and execute the gallery refresh script
          const { default: loadImages } = await import('../../scripts/load-images.js');
          await loadImages(); // Load images, but do not manipulate DOM
          // Dispatch event to trigger state update in PhotoGridClient
          window.dispatchEvent(new CustomEvent('refreshGallery'));
          // Show success feedback
          refreshBtn.classList.remove('loading');
          refreshBtn.classList.add('success');
          refreshIcon.classList.remove('spin');
          refreshIcon.innerHTML = '<path d="M20 6L9 17l-5-5"/>';
          setTimeout(() => {
            // Reset to original icon
            refreshBtn.classList.remove('success');
            refreshIcon.innerHTML = '<path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"/><path d="M20.49 15a9 9 0 0 1-14.13 3.36L1 14"/>';
            refreshBtn.blur();
          }, 2000);
          console.debug('[RefreshButton] Images updated!');
        } catch (err) {
          // Show error feedback
          refreshBtn.classList.remove('loading');
          refreshBtn.classList.add('error');
          refreshIcon.classList.remove('spin');
          refreshIcon.innerHTML = '<path d="M18 6L6 18"/><path d="M6 6l12 12"/>';
          setTimeout(() => {
            // Reset to original icon
            refreshBtn.classList.remove('error');
            refreshIcon.innerHTML = '<path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"/><path d="M20.49 15a9 9 0 0 1-14.13 3.36L1 14"/>';
            refreshBtn.blur();
          }, 2000);
          console.error('[RefreshButton] Error loading images:', err);
        }
      };
    }
  </script>
</button>